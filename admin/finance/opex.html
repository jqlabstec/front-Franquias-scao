<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Financeiro ¬∑ Custos (OPEX)</title>

  <link rel="stylesheet" href="../../../saidbar/saidebar.css" />
  <link rel="stylesheet" href="../finance/finance.css" />
  <link rel="stylesheet" href="./opex.css" />

  <script>window.SIDEBAR_ACTIVE='finance-dashboard';</script>
  <script src="../../../saidbar/saidebar.js" defer></script>
  <script type="module" src="../vendor/helpers.js"></script>
  <script type="module" src="./opex.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  
  <style>
    /* ‚úÖ Estilos para o modal funcionar */
    dialog {
      border: none;
      border-radius: 12px;
      padding: 0;
      max-width: 600px;
      width: 90%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    
    dialog::backdrop {
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
    }
    
    .form {
      padding: 24px;
    }
    
    .form h3 {
      margin: 0 0 20px 0;
      font-size: 20px;
      color: #0f172a;
    }
    
    .form .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-bottom: 24px;
    }
    
    .form label {
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 14px;
      font-weight: 600;
      color: #334155;
    }
    
    .form label.inline {
      flex-direction: row;
      align-items: center;
      grid-column: 1 / -1;
    }
    
    .form input[type="text"],
    .form input[type="number"],
    .form input[type="date"],
    .form select {
      padding: 10px 12px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      font-size: 14px;
      font-family: inherit;
    }
    
    .form input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }
    
    .form menu {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      margin: 0;
      padding: 0;
    }
    
    /* ‚úÖ Campos de c√°lculo autom√°tico */
    #autoCalcFields {
      grid-column: 1 / -1;
      display: none;
      background: #f8f9fa;
      padding: 16px;
      border-radius: 8px;
      gap: 12px;
    }
    
    #autoCalcFields label {
      margin-bottom: 8px;
    }
    
    #autoCalcFields small {
      color: #6b7280;
      font-size: 12px;
      font-weight: 400;
    }
    
    #calculatedValue {
      font-size: 18px;
      font-weight: 700;
      color: #22c55e;
    }
    
    .pill {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .pill.ok {
      background: #d1fae5;
      color: #065f46;
    }
    
    .pill.no {
      background: #fee2e2;
      color: #991b1b;
    }
  </style>
</head>
<body>
  <div class="app-layout">
    <aside id="sidebar-root"></aside>

    <div class="app-content">
      <main class="shell">
        <section class="card">
          <div class="card-head">
            <h1>üí∞ Custos Operacionais</h1>
            <div class="filters">
              <input id="q" placeholder="Buscar descri√ß√£o" />
              <select id="category">
                <option value="">Categoria: todas</option>
                <option value="FIXED">Fixos</option>
                <option value="VARIABLE">Vari√°veis</option>
              </select>
              
              <!-- ‚úÖ FILTRO COMPLETO COM IMPOSTOS -->
              <select id="costType">
                <option value="">Tipo: todos</option>
                
                <optgroup label="üí∞ Impostos sobre Vendas">
                  <option value="SIMPLES_NACIONAL">Simples Nacional</option>
                  <option value="ICMS">ICMS</option>
                  <option value="PIS">PIS</option>
                  <option value="COFINS">COFINS</option>
                  <option value="ISS">ISS</option>
                  <option value="TAX_OTHER">Outros Impostos</option>
                </optgroup>
                
                <optgroup label="üè† Ocupa√ß√£o">
                  <option value="RENT">Aluguel</option>
                  <option value="CONDO_FEE">Condom√≠nio</option>
                  <option value="SHOPPING_PROMO_FUND">Fundo Shopping</option>
                  <option value="PROPERTY_TAX">IPTU</option>
                  <option value="WATER">√Ågua</option>
                  <option value="ELECTRICITY">Energia</option>
                  <option value="AC_MAINTENANCE">Ar Condicionado</option>
                  <option value="GAS">G√°s</option>
                </optgroup>
                
                <optgroup label="üë• Recursos Humanos">
                  <option value="SALARY">Sal√°rios</option>
                  <option value="LABOR_CHARGES">Encargos</option>
                  <option value="BENEFITS">Benef√≠cios</option>
                  <option value="TRAINING">Treinamentos</option>
                </optgroup>
                
                <optgroup label="üîß Consumos">
                  <option value="INTERNET">Internet</option>
                  <option value="CLEANING">Limpeza</option>
                  <option value="MAINTENANCE">Manuten√ß√£o</option>
                  <option value="OFFICE_SUPPLIES">Material Escrit√≥rio</option>
                  <option value="EQUIPMENT_RENTAL">Aluguel Equipamentos</option>
                  <option value="EQUIPMENT_UTENSILS">Equipamentos</option>
                  <option value="PHONE">Telefone</option>
                </optgroup>
                
                <optgroup label="üìã Administrativo">
                  <option value="IT_SOFTWARE">Software/TI</option>
                  <option value="ACCOUNTING">Contador</option>
                  <option value="INSURANCE">Seguros</option>
                  <option value="PROFESSIONAL_SERVICE">Serv. Profissionais</option>
                  <option value="BANK_FEE">Tarifas Banc√°rias</option>
                  <option value="ADMINISTRATIVE">Administrativo</option>
                  <option value="LEGAL">Advocacia</option>
                </optgroup>
                
                <optgroup label="üè¢ Franquia">
                  <option value="ROYALTY">Royalties</option>
                  <option value="MARKETING_FUND">Fundo Marketing</option>
                </optgroup>
                
                <optgroup label="üì¢ Marketing">
                  <option value="MARKETING">Marketing</option>
                  <option value="ADVERTISING">Publicidade</option>
                </optgroup>
                
                <optgroup label="üõµ Delivery">
                  <option value="DELIVERY_FEE">Taxas Delivery</option>
                  <option value="ACQUIRER_FEE">Adquir√™ncia</option>
                  <option value="TRANSACTION_FEE">Taxas Transa√ß√£o</option>
                </optgroup>
                
                <optgroup label="üîπ Outros">
                  <option value="TRANSFER_FEE">Taxa Transfer√™ncia</option>
                  <option value="PLR">PLR</option>
                  <option value="DEPRECIATION">Deprecia√ß√£o</option>
                  <option value="COMMISSION">Comiss√µes</option>
                  <option value="FREIGHT">Frete</option>
                  <option value="SECURITY">Seguran√ßa</option>
                  <option value="TAX">Impostos (Antigo)</option>
                  <option value="UTILITIES">Utilidades</option>
                  <option value="OTHER">Outros</option>
                </optgroup>
              </select>
              
              <input id="from" type="date" />
              <span class="sep">‚Üí</span>
              <input id="to" type="date" />
              <button id="applyBtn" class="btn-primary">Aplicar</button>
              <button id="newBtn" class="btn-ghost">+ Novo custo</button>
            </div>
          </div>

          <div class="banner hidden" id="status"></div>

          <div class="table-wrap">
            <table class="tbl" id="tbl">
              <thead>
                <tr>
                  <th>Data</th>
                  <th>Descri√ß√£o</th>
                  <th>Tipo</th>
                  <th>Cat.</th>
                  <th>Base</th>
                  <th>Rec.</th>
                  <th class="num">Valor</th>
                  <th></th>
                </tr>
              </thead>
              <tbody id="tbody">
                <tr><td colspan="8" class="muted">Sem resultados</td></tr>
              </tbody>
              <tfoot>
                <tr>
                  <th colspan="6" class="num">Total</th>
                  <th class="num" id="tfoot-total">‚Äî</th>
                  <th></th>
                </tr>
              </tfoot>
            </table>
          </div>
        </section>

        <!-- ‚úÖ MODAL COMPLETO COM IMPOSTOS -->
        <dialog id="costDialog">
          <form method="dialog" class="form">
            <h3 id="dlgTitle">Novo custo</h3>
            
            <div class="grid">
              <label style="grid-column: 1 / -1;">Descri√ß√£o
                <input id="f-description" type="text" required placeholder="Ex: Simples Nacional Setembro - 6% sobre faturamento" />
              </label>
              
              <!-- ‚úÖ TIPO DE CUSTO COMPLETO COM IMPOSTOS -->
              <label style="grid-column: 1 / -1;">Tipo de custo
                <select id="f-costType" required>
                  <optgroup label="üí∞ Impostos sobre Vendas">
                    <option value="SIMPLES_NACIONAL">Simples Nacional</option>
                    <option value="ICMS">ICMS</option>
                    <option value="PIS">PIS</option>
                    <option value="COFINS">COFINS</option>
                    <option value="ISS">ISS</option>
                    <option value="TAX_OTHER">Outros Impostos</option>
                  </optgroup>
                  
                  <optgroup label="üè† Ocupa√ß√£o">
                    <option value="RENT">Aluguel</option>
                    <option value="CONDO_FEE">Condom√≠nio</option>
                    <option value="SHOPPING_PROMO_FUND">Fundo Promo√ß√£o Shopping</option>
                    <option value="PROPERTY_TAX">IPTU</option>
                    <option value="WATER">√Ågua</option>
                    <option value="ELECTRICITY">Energia El√©trica</option>
                    <option value="AC_MAINTENANCE">Ar Condicionado</option>
                    <option value="GAS">G√°s</option>
                  </optgroup>
                  
                  <optgroup label="üë• Recursos Humanos">
                    <option value="SALARY">Sal√°rios</option>
                    <option value="LABOR_CHARGES">Encargos Trabalhistas</option>
                    <option value="BENEFITS">Benef√≠cios (VT, VA, VR)</option>
                    <option value="TRAINING">Treinamentos</option>
                  </optgroup>
                  
                  <optgroup label="üîß Consumos e Utilidades">
                    <option value="INTERNET">Internet</option>
                    <option value="CLEANING">Limpeza e Conserva√ß√£o</option>
                    <option value="MAINTENANCE">Manuten√ß√£o</option>
                    <option value="OFFICE_SUPPLIES">Material de Escrit√≥rio</option>
                    <option value="EQUIPMENT_UTENSILS">Equipamentos e Utens√≠lios</option>
                    <option value="EQUIPMENT_RENTAL">Aluguel de Equipamentos</option>
                    <option value="PHONE">Telefone</option>
                  </optgroup>
                  
                  <optgroup label="üìã Administrativo">
                    <option value="IT_SOFTWARE">Software/ERP/SaaS</option>
                    <option value="ACCOUNTING">Contador</option>
                    <option value="INSURANCE">Seguros</option>
                    <option value="PROFESSIONAL_SERVICE">Servi√ßos Profissionais</option>
                    <option value="BANK_FEE">Tarifas Banc√°rias</option>
                    <option value="ADMINISTRATIVE">Outros Administrativos</option>
                    <option value="LEGAL">Advocacia</option>
                  </optgroup>
                  
                  <optgroup label="üè¢ Franquia">
                    <option value="ROYALTY">Royalties</option>
                    <option value="MARKETING_FUND">Fundo de Marketing/Propaganda</option>
                  </optgroup>
                  
                  <optgroup label="üì¢ Marketing">
                    <option value="MARKETING">Marketing Local</option>
                    <option value="ADVERTISING">Publicidade</option>
                  </optgroup>
                  
                  <optgroup label="üõµ Delivery e Marketplace">
                    <option value="DELIVERY_FEE">Taxas Delivery (iFood, Rappi, Uber Eats)</option>
                    <option value="ACQUIRER_FEE">Adquir√™ncia (Stone, Cielo, Rede)</option>
                    <option value="TRANSACTION_FEE">Taxas de Transa√ß√£o</option>
                  </optgroup>
                  
                  <optgroup label="üîπ Outros">
                    <option value="TRANSFER_FEE">Taxa de Transfer√™ncia</option>
                    <option value="PLR">Participa√ß√£o nos Lucros</option>
                    <option value="DEPRECIATION">Deprecia√ß√£o</option>
                    <option value="COMMISSION">Comiss√µes</option>
                    <option value="FREIGHT">Frete</option>
                    <option value="SECURITY">Seguran√ßa</option>
                    <option value="TAX">Impostos (Antigo)</option>
                    <option value="UTILITIES">Utilidades (√Ågua/Luz/G√°s)</option>
                    <option value="OTHER" selected>Outros</option>
                  </optgroup>
                </select>
              </label>
              
              <label>Categoria
                <select id="f-category" required>
                  <option value="FIXED">Fixo</option>
                  <option value="VARIABLE">Vari√°vel</option>
                </select>
              </label>
              
              <label>Data
                <input id="f-date" type="date" required />
              </label>
              
              <!-- ‚úÖ NOVO: Modo de c√°lculo -->
              <label style="grid-column: 1 / -1;" class="inline">
                <input id="f-autoCalc" type="checkbox" /> Calcular automaticamente baseado em percentual
              </label>
              
              <!-- ‚úÖ Campos de c√°lculo autom√°tico -->
              <div id="autoCalcFields">
                <label>Valor Base (R$)
                  <input id="f-baseValue" type="number" step="0.01" min="0" placeholder="Ex: 25000.00" />
                  <small>Faturamento ou valor de refer√™ncia</small>
                </label>
                
                <label>Percentual (%)
                  <input id="f-percentage" type="number" step="0.01" min="0" max="100" placeholder="Ex: 6.0" />
                  <small>Ex: 6.0 para 6%</small>
                </label>
                
                <div style="padding: 12px; background: #fff; border-radius: 6px; border: 2px solid #22c55e; grid-column: 1 / -1;">
                  <strong>Valor Calculado:</strong> <span id="calculatedValue">R$ 0,00</span>
                </div>
              </div>
              
              <!-- ‚úÖ Campo de valor manual -->
              <label id="manualValueField" style="grid-column: 1 / -1;">Valor (R$)
                <input id="f-amount" type="number" step="0.01" min="0.01" required />
              </label>
              
              <label>Base de Reconhecimento
                <select id="f-basis" required>
                  <option value="ACCRUAL">Compet√™ncia</option>
                  <option value="CASH">Caixa</option>
                </select>
              </label>
              
              <label class="inline">
                <input id="f-rec" type="checkbox" /> Recorrente
              </label>
            </div>
            
            <menu>
              <button type="button" id="dlgCancel" class="btn-ghost">Cancelar</button>
              <button type="button" id="dlgSave" class="btn-primary">Salvar</button>
            </menu>
          </form>
        </dialog>
      </main>
    </div>
  </div>
</body>
</html>